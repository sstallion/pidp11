#
# CC Command
#

OS_CCDEFS = -lrt -lm -D_GNU_SOURCE
CC_DBG_FLAGS = -ggdb3 -O0

# fuer beaglebone und angstrom stand alone toolchain
CCARM = arm-angstrom-linux-gnueabi-gcc -mthumb -march=armv7-a -std=c99 -U__STRICT_ANSI__ $(CC_DBG_FLAGS) $(OS_CCDEFS) -I.

CCDEFS= -I$(LIBANTLR3C_DIR) -I$(LIBANTLR3C_DIR)/include -I$(ANTLR_OUTDIR)
#### !!! wenn cross compliling !!!!
#CC=$(CCARM)




# parser and lexer for config file are generated by ANTLRWorks
LIBANTLR3C_DIR=$(HOME)/libantlr3c-3.1.4-SNAPSHOT
# produces C sources
ANTLR_OUTDIR=./output

# 
ANTLR_SOURCES.c=$(LIBANTLR3C_DIR)/src/antlr3lexer.c \
	$(LIBANTLR3C_DIR)/src/antlr3baserecognizer.c	\
	$(LIBANTLR3C_DIR)/src/antlr3collections.c	\
	$(LIBANTLR3C_DIR)/src/antlr3exception.c	\
	$(LIBANTLR3C_DIR)/src/antlr3bitset.c	\
	$(LIBANTLR3C_DIR)/src/antlr3commontoken.c	\
	$(LIBANTLR3C_DIR)/src/antlr3string.c	\
	$(LIBANTLR3C_DIR)/src/antlr3convertutf.c	\
	$(LIBANTLR3C_DIR)/src/antlr3intstream.c	\
	$(LIBANTLR3C_DIR)/src/antlr3inputstream.c	\
	$(LIBANTLR3C_DIR)/src/antlr3filestream.c	\
	$(LIBANTLR3C_DIR)/src/antlr3tokenstream.c	\
	$(LIBANTLR3C_DIR)/src/antlr3parser.c	

SOURCES.h = $(ANTLR_OUTDIR)/blinkenlight_panel_configLexer.h	\
	$(ANTLR_OUTDIR)/blinkenlight_panel_configParser.c
SOURCES.c = grammartest.c	\
 	$(ANTLR_SOURCES.c) \
	$(ANTLR_OUTDIR)/blinkenlight_panel_configLexer.c  \
	$(ANTLR_OUTDIR)/blinkenlight_panel_configParser.c


OBJECTS = $(SOURCES.c:%.c=%.o) 
#
# Build everything
#
all:    grammartest testconf

clean:
	rm -f grammartest $(OBJECTS)

testconf:
	# cat all panels configs into one big test conf
	cat `find ../../../panels -name '*.conf' ` >test.conf
	

grammartest:	$(SOURCES.c)
	${CC} $^ -o $@ $(CCDEFS) ${LDFLAGS}
