
Tests on LCM 11/70 "Miss Piggy"
- Duration of RESET: not 70ms, but 10ms! (PDP-11_70_Handbook_1977-78.pdf, 4-81)

- RUN LED: on during RESET, off during PAUSE.

- PAUSE:
on during WAIT? script 10 NO!
ON during disk I/O (script 18 UnixV7 tests), then RUN is OFF.

- MASTER
- ON bei HALT (script10), OFF bei RUN (contradiction to DEC manual?)
MASTER = UBCA CPBSY =>


Parity LEDs:
- not always in SYNC with DAT LEDs. Only on Memory READ, only if BUS REG!
- "OFF on write" ?
- Both OFF on manual DEPOSIT & EXAM (script17_TB8A3106)  ???
- But Works on EXAM script01_TB8A3110 ?			 ???


"ADRS ERR" LED:
LCM2018, script 8:
Set SWR=17777754
Press LOAD ADRS
Press and hold down EXAM
->ADDRESS display changes to 17600000 ! -> bits 15..0 cleared?
LCM2018, script 9:
ADDRESS display does not change when in auto increment !!

R0 in WAIT,RESET,HALT:
see PDP-11-70 Field Maintenance Print Set (Nov 1975, MP0KB11-C0).pdf, sheet "FLOWS 3"
WAIT: ADRS light = PC, SHifter = DR = R0
HALT:  R0->DR
RESET: R0 -> DR
"DR" is "destination register" (not "Display register). Input to shifter
-> DR is visible if selection is DATA PATH.


################################################################################

II Original DEC documentation
From "KB11C PROCESSOR MANUAL (PDP-11-70) (1975, EK-KB11C-TM-001).pdf"

Section III, Chapter 1: Switches, Indicators and Operation
pdf pages 185-192

INTRODUCTION
The PDP-11/70 Console, drawing D-CS-54-11294-0-1, allows direct control of the
KB11-C computer system. The Console is used for starting, stopping, resetting
and debugging. Its power switch may be used as the master switch for a system.
Indicator lights and the other switches provide facilities for monitoring,
system control and maintenance operations, during which the KB11-C can be made
to execeute single instructions or single Unibus or Memory cycles. The contents
of any memory location or of any register can be examined, and data can be
entered manually from the switches.

Chapter 1 describes the various components of the Console and their use; Chapter
2 describes the logic that controls Console operations.

CHAPTER 1 SWITCHES, INDICATORS AND OPERATION

1.1 OPERATIONAL SWITCHES

1.1.1 Power and Lamp Test Switches
The POWER switch is a three-position, key-operated switch.

OFF - Causes power to be removed from the switched outlets of the Power
      Controller.  Renders the system inoperative.

POWER - Power is applied to the system. All switches are operational.

LOCK - Same as POWER, except that the LOAD ADRS, EXAM, DEP, CONT, ENABLE/HALT, S
       INST/S BUS CYCLE and START switches are disabled. All other switches are
       operational.

The LAMP TEST switch is the white switch between Switch Register 0 and LOAD
ADRS. When raised, it turns all the indicators on. It is used for maintenance.

1.1.2 LOAD ADRS Switch
The LOAD ADRS switch is a momentary action switch. When this switch is
depressed, bits 21 - 16 of the Switch Register are loaded into SCCK SWR(21:16) B
(1) H, and bits 15 - 00 into the PCA and the SR. The address displayed in the
ADDRESS display indicators is a function of the ADDRESS SELECT switch (Paragraph
1.2.1 below).

1.1.3 EXAM Switch
The EXAM(ine) switch is a momentary action switch. When it is depressed, the
contents of the location specified by the ADDRESS display is shown by the DATA
indicators, if the DATA SELECT switch is in the DATA PATHS position.
The ADDRESS display shows either a virtual or a physical address, as determined
by the ADDRESS SELECT switch. Refer to Paragraph 1.2.1

1.1.4 DEP Switch
The DEP(osit) switch is a momentary action switch. When it is raised, the
contents of bits 15 - 00 of the Switch Register are written into the location
specified by the physical address generated by the last LOAD ADRS operation. The
data written is shown by the DATA indicators if the DATA SELECT switch is in the
DATA PATHS position.

The ADDRESS display shows either a virtual or a physical address, as determined
by the ADDRESS SELECT switch, Refer to Paragraph 1.2.1

1.1.5 Step Operations
If several consecutive EXAM operations are performed, the address is incremented
by 2 for each operation after the first one. Thus, it is possible to examine a
series of consecutive word addresses without doing a LOAD ADRS for each EXAM.

In the same manner, it is possible to execute a series of DEP operations without
doing a LOAD ADRS for each one.

The following sequence illustrates these operations

   Operation           Location Shown in
(Activate Switch)      ADDRESS Display
LOAD ADRS                   X
EXAM                        X
DEP                         X
EXAM                        X
EXAM                       X+2
    (Result is EXAM - STEP)
DEP                        X+2
EXAM                       X+2


1.1.6 CONT Switch
The CONT(inue) switch is a momentary action switch whose action depends upon the
position of the HALT/ENABLE switch:

ENABLE - Resumes program execution at the point where it was stopped by the HALT
         switch or by a HALT instruction.

HALT - Used in conjunction with the S INST/S BUS CYCLE switch. See Paragraph
         1.1.8.

The CONT switch has the same effect as the Maintenance Module Stepper Switch,
XMAA S4, when executing single ROM cycles or UPB stops, but not when executing
single clock cycles.

1.1.7 ENABLE/HALT Switch
The ENABLE/HALT switch is a two-position switch:

ENABLE - Used in conjunction with the START or CONT switches, allows program
         execution.
HALT - Stops program execution.

1.1.8 S INST/S BUS CYCLE Switch
The S(ingle) INST(ruction)/S(ingle) BUS CYCLE switch is used in conjunction with
the CONT switch when the HALT/ENABLE switch is in the HALT position:

S INST - When CONT is depressed, a single instruction is executed and the
          processor stops in CON.00. EXAM and DEP operations may then be
          executed. The contents of the DATA Display indicators may only be
          determined by examination of the microprogram Flows for the
          instruction that hasjust been executed.

S BUS CYCLE - When CONT is depressed, execution is resumed but stops in T5 of
          PAUSE of the first Unibus or Memory cycle to be executed.
          The ADDRESS display then contains the address of the location at which
          the bus cycle was performed (virtual or physical, depending on the
          position of the ADDRESS SELECT switch).

          If the DATA SELECT switch is selecting BUS REG (Bus Register), the
          DATA display lights, on a read operation, will contain the data that
          was read (this could be an instruc-tion or data). During a write
          operation, the lights will contain the data just written (except
          during a stack operation or Floating Point in-struction). LOAD ADRS,
          EXAM and DEP are disabled in this mode. If an EXAM or DEP operation is
          desired, the S INST/S BUS CYCLE switch should be changed to S INST and
          the CONT switch should be depressed once. (This will cause execution
          until the end of the current instruction). The system will then be
          ready to perform an EXAM or DEP.

The switch has no effect when the HALT/ENABLE switch is set to ENABLE.

1.1.9 START Switch
The START switch is a momentary action switch whose action depends upon the
setting of the HALT/ENABLE switch:

ENABLE - Starts program execution at the address previously loaded by a LOAD
         ADRS, after resetting the system (INIT).

HALT   - Resets the system.

The START switch has no effect when the processor is in the RUN state.

1.1.10 Switch Register
The Switch Register consists of the 22 switches labeled 0 through 21. These
numbers correspond to the bit positions of their respective switches. The Switch
Register is used to manually enter both addresses and data into the KB11-C, and
its bits, 15 - 00, may be read under program control; its address is 17 777 570.
which is the same as that of the Display Register.

1.2 ADDRESSING AND DATA DISPLAY

1.2.1 ADDRESS SELECT Switch
The ADDRESS SELECT switch is an eight-position rotary switch:

VIRTUAL - Six positions: KERNEL, SUPER and USER I space and KERNEL, SUPER and
          USER D space. The address displayed is a 16-bit virtual address; bits
          21 -16 are always off. During Console DEP or EXAM operations, bits
          15:00 of the Switch Register are considered to be a Virtual Address.
          If Memory Management is enabled, this Virtual Address is relocated.
          The set of PAR/PDRs indicated by the switch position is used.

CONS PHY - (Console Physical). The 22-bit address entered by a LOAD ADRS is the
          physical address of the Console operation.

PROG PHY - (Program Physical). Displays the 22-bit physical address generated by
          Memory Management for the current Unibus or Memory cycle.

The ADDRESS SELECT switch indicator lights are driven directly by the switch.

Refer to Paragraph 1.4 which explains the use of the ADDRESS SELECT switch.

1.2.2 ADDRESS Display Indicators
The ADDRESS display indicators show the address of the data deposited or being
examined. The address is interpreted as a virtual or physical address in
accordance with the position of the ADDRESS SELECT switch. (Paragraph 1.2.1
below).

1.2.3 DATA SELECT Switch
The DATA SELECT switch is a four-position rotary switch:

DATA PATHS - Displays the output of the Shifter. This position is the normal
          display mode, and is used to show the data examined or deposited by
          Console operations.

BUS REG - Displays the output of the Bus Register (BR).

uADRS FPP/CPU - Bits 15 - 08 display the current address of the Floating Point
          Processor microprogram ROM.
          Bits 07 - 00 display the current address of the processor microprogram
          ROM.

DISPLAY REGISTER - Displays the contents of the Light Register. The LR may be
          written into by using address 17 777 570, which is the same as that of
          the Switch Register.

1.2.4 DATA Display Indicators
The DATA indicators display the output of the Data Display Multiplexer. The
output of the multi-plexer is selected by the DATA SELECT switch. Refer to
Paragraph 1.2.3.

1.2.5 PARITY Indicators
The PARITY indicators display the parity bits associated with the HIGH and LOW
bytes of the word read from Cache Memory. These indicators are off during at
write operation.

1.3 EXECUTION INDICATORS

1.3.1 PAR ERR Indicator
The PAR(ity) ERR(or) indicator is on when a Unibus or a memory parity error is
flagged.

1.3.2 ADRS ERR Indicator
The ADRS (Address) ERR (Error) indicator is on when an addressing error occurs.
Address errors are: non-existent memorya access control violation, page length
error, Stack Limit Red, odd address error and Unibus Timeout. This is a dynamic
indication of address errors that occur during program execution. It is a static
indication during Console functions (i.e., EXAM or DEP).

1.3.3 RUN Indicator
The RUN indicator is on when the processor is executing instructions, but is off
during Pause cycles. The RUN indicator is on during a WAIT instruction.

1.3.4 PAUSE Indicator
The PAUSE indicator is on during all Bus Pause and Interrupt Pause cycles,
indicating that the processor is waiting for either Memory or a Unibus device.

1.3.5 MASTER Indicator
The MASTER indicator is on either when the processor is Unibus master (UBCA
CPBSY) or during Console operations [TMCA CONF (1)L asserted].

1.3.6 KERNEL, SUPER, USER Indicators
The KERNEL, SUPER and USER indicators show the actual mode in which the
processor is operating during each cycle. Refer to Section IV of this manual
(Memory Management).

1.3.7 ADDRESSING (Mapping) Indicators
The 16-, 18-, and 22-bit indicators show the Memory Management mapping that is
being used during each cycle.

1.3.8 DATA (Space) Indicator
The DATA indicator shows whether I or D space is used during each cycle. It is
on when D space is used and off when I space is used.

1.4 USAGE

1.4.1 Memory Reference
Memory references from the Console may be either mapped (i.e., using a virtual
address) or unmapped (using a physical address), when Memory Management is
enabled. Mapped references are possible only when Memory Management is enabled.

1.4.1.1 Unmapped Reference
1.  Set the ADDRESS SELECT switch to CONS PHYS.
2.  Enter the 22-bit physical address into the Switch Register.
3.  Depress the LOAD ADRS switch. The physical address in shown by the ADDRESS
    display.
4.  Set the DATA SELECT switch to DATA PATHS.
5a. If the EXAM switch is depressed, the contents of the physical memory
    location entered by the LOAD ADRS operation is displayed by the DATA
    indicators.
5b. If the DEP switch is raised, the contents of bits 15 - 00 of the Switch
    Register are written into the physical memory location entered by the LOAD
    ADRS operation. This same data is displayed by the DATA indicators.

1.4.1.2 Mapped Reference
1.  Set the ADDRESS SELECT switch to one of the virtual positions (refer to
    Paragraph 1.2.1).
2.  Enter the 16-bit virtual address into the Switch Register.
3.  Depress the LOAD ADRS switch. The virtual address is shown by the ADDRESS
    display. Bits 21 - 16 are off.
4.  Set the DATA SELECT switch to DATA PATHS.
5a. If the EXAM switch is depressed, the virtual address loaded by the LOAD ADRS
    operation is relocated by Memory Management. Memory Management (if it is
    enabled) uses the mapping shown by the ADDRESSING indicators (Paragraph
    1.3.8) and the PAR/PDR pair is selected by the ADDRESS SELECT switch. The
    contents of this address are read and displayed by the DATA indicators.
5b. If the DEP switch is raised, the virtual address is relocated as in the EXAM
    operation. The contents of the Switch Register are written into the physical
    memory location pointed to by the physical address. The new contents of this
    location are displayed by the DATA indicators.
6.  If the ADDRESS SELECT switch is now turned to PROG PHY, the physical address
    corresponding to the virtual address used during the EXAM or DEP operation
    is displayed by the ADDRESS indicators.

1.4.2 General Register Reference
EXAM and DEP references to the processor General Registers may be executed by
entering the address of the register (see Table 1-1) into the SWITCH REGISTER,
depressing LOAD ADRS, and then EXAM or DEP, as required. The ADDRESS SELECT
switch setting is ignored; mapping to a General Register is not possible.

EXAM-STEP and DEP-STEP operations can be performed on the General Registers, in
a manner similar to that for memory locations, except that:
1. ADDRESS display is incremented by 1 (instead of 2).
2. The STEP after address 17 777 717 is 17 777 700, such that the addresses are
   looped.
3. It is not possible to STEP up to the first General Register (17 777 700) from
   17 777 676.

                            Table 1-1
                    General Register Addresses
                              SET 0
Register 0                                   17 777 700
    ...                                          ...
Register 5                                   17 777 705
Register 6, Kernel                           17 777 706
Program Counter                              17 777 707

                              SET 1
Register 0                                   17 777 710
    ...                                          ...
Register 5                                   17 777 715
Register 6, Super                            17 777 716
Register 6, User                             17 777 717



*****
Section III, Chapter 2

2.5  CONSOLE BRANCH
The Console microprogram flows are shown on Flows 14.

2.5.1  Idle State
CON.00 is the KBI 1-C idle state which is entered upon a HALT. This cycle loops
upon itself until one of the Console switches sets UBCF CNSL ACT (I) H. This
function is low during the idle state:  the Branch Enable field of CON.00 is 14,
making both RACK BEF(3:2)3 H and RACK BEF(1:0)0 H high. RACK BRCAB06 L is thus
asserted. Since the UADR field of CON.00 is 070, bit 6 is forced to 1, the ROM
address [RACL RA DR(07:00) H] becomes 10, the address of CON.00, which thus
succeeds itself.  RACK BRCAB06 L is not used by any other microstate.

2.5.2  LOAD ADRS
If the LOAD ADRS switch is now depressed, UBCF CNSL07 (1) H and UBCF CNSL ACT
(1) H are both asserted; this causes RACK BRCAB07 to be asserted, thus
generating a ROM address of 270 (ADR.00). [UBCF CNSL07 (0) H forces UBCH
CNS(02:00) H low]. RACK BRCAB07 L is used only by LOAD ADDRESS.

2.5.3  RACK BRCAB(02:00) L
These bits determine the branch required by the eight remaining functions:
START, CONT, EXAM, DEP, STEP EXAM, STEP DEP, REG EXAM/DEP and REG EXAM/DEP STEP.
The bits are shown on UBCH.

2.5.4  START and CONT
START and CONT are encoded on UBCH. Since BCF CNSL07 (0) H is high (LOAD ADRS is
not depressed), UBCH CNSL(02:00) equals 6 for START and 7 for CONT. Since the
processor is in the idle state, RACK BRCAB(02:00) L force the next cycle
microaddress respectively to 076 or 077.

2.5.5  EXAM and DEP Switches
As described in Chapter I, every successive depression of the EXAM switch after
the first one causes the address to be incremented, thus making it possible to
examine successive locations without reloading the address. This same procedure
is followed for DEP, or when operating on General Registers. Operations
following the first one are called STEP operations. Refer to Flows 14.

The logic shown on UBCH stores UBCH CNSL(02:00) H and UBCH MSB DATA L, in the
74S175 register, the output of which is decoded by the 7442S. The functions
generated by the outputs of these decoders are gated with the outputs of the UBCH
switch flip-flops and thus generate a modified UBCH CNSL(02:00) H value,
which in turn causes a different branch address to be generated when EXAM or DEP
are depressed more than once. Note that when R3(1) of the 74S175 is high, the
lower 7442 decoder is disabled (no outputs fO-f7 can be true), while the upper
7442 is enabled, since R3(0) is low;  if R3 is reset, the opposite is true.

Register operations are similar to Memory operations. The branch after CON.00
determines whether the operation is or is not a STEP operation. A second branch
after this executes either an EXAM or a DEP.

Figure 2-1 shows a sequence of operations, shown above the waveshapes, the
condition of the various modifying functions, and the inputs to the RACK logic.


....

2.8  LOAD ADDRESS
During CON.00, bits 15 - 00 of the Switch Register are loaded into the BR.
During ADR.00 (LOAD ADDRESS), the contents of the BR are loaded into the SR and
into the PCA. These bits are used in any subsequent Console operation other than
a LOAD ADRS.

The actual physical address used during these operations is determined by Memory
Management from the position of the ADDRESS SELECT switch


2.9  EXAM AND DEP OPERATIONS
EXAM, DEP, REG EXAM/DEP and their respective STEP operations are described by Flows 14.

2.10  ADDRESS DISPLAY
The ADDRESS DISPLAY indicators are driven by KNLB VA(03:00) and
KNLB DISP ADRS(21:04) H. These signals are received on J2 by the Console.
They originate on the M8140 module (SCCJ) connector J1. SCCA VA(03:00) H,
SCCF DISP ADRS(05:04) H and SCCK DISP ADRS(21:06) H are the sources for the
KNLB signals.

Refer to Table 2-1. The address displayed depends on whether or not it is a
General Register (GR) address ( 17 777 700 - 17 777 717).

                     Table 2-1  Address Display
-----------+---------------+----------------------+-----------+-----------------
Display    |    Virtual    | Adress Select Switch | PROG PHY  | General Register
Indicators | (6 positions) |       CONS PHY       |           | Access
-----------+---------------+----------------------+-----------|-----------------
00-03      | VA(00:03)     | VA(00:03)            | VA(00:03) | VA(00:03)
04,05      | VA04,05       | VA04,05              | VA04,05   |   OFF
06-15      | VA(06:15)     | VA(06:15)            | PA(06:15)!|   ON
16-21      |    OFF        | SWR(16:21)           | PA(16:21) |   ON
-----------+---------------+----------------------+-----------+-----------------
"!PA" = typo in DEC manual corrected

2.10.1  General Register (GR) Address

If the address is a GR address, bits 00:03 display the register number (0 to
17), bits 4 and 5 are Os (off), and bits 06:21 are 1s (on). SCCF GEN REG ADRS
is asserted (Switch Register bits 21 - 06 high, bits 05 and 04 low) and
SCCF GEN REG (1) H is set when the LOAD ADDRESS switch is depressed. This forces
SCCF DISP ADRS(05:04) low and their corresponding indicators off, and also forces low
both select inputs to the SCCK DISP ADRS(21:16) H multiplexer, thus selecting
its A inputs (+3 V) and forcing the corresponding indicators on.  The
SCCK DISP ADRS(15:06) H multiplexer is disabled by SCCF GEN REG (1) H and its outputs
are high, thus forcing their corresponding indicators on. V A(OJ:OO) determine
the state of address indicators 03-00.

2.10.2  Memory Address
If the address is not a GR address, the address display is a function of the
ADDRESS SELECT switch, described in Paragraph 1.12. The output of this switch is
encoded on the Console board. Three signals, NLD DISP ADRS SEL(2:0) H are thus
generated. They are decoded on SSRK and used in the Memory Management logic.
Two of these signals control the multiplexers on SCCK and determine the source
of the address display, as shown in Table 2-1.  VA(05:00) are used for all
three mappings, since these bits never change (they are not relocated).
VA(15:06) is used for the VIRTUAL and CONS PHYS positions (the Switch Register is
loaded into the SR after a LOAD ADRS and read from the BAMX).
In VIRTUAL, bits 21:16 are forced  off. In CONS PHY, SCCK SWR(21:16) H
are read. In PROG PHY, PA(21:06) are displayed.

2.11  DATA DISPLAY
The DATA indicators [KNLA DISP D(l5:00) H and DI SP PAR HI (and LO) H] receive
their input from the Data Display multiplexer, PDRF DISP D(15:OO) H. and from
two flip-flops, PDRH IND HI (or LO) PAR H.

PDRF DISP D(15:00) H selects one of four inputs.  (Refer to Paragraph 1.20.) The
select inputs to this multiplexer are encoded from the DATA SELECT switch
[KNLD DISP DATA SELL (or SELO) H] and input to S1 and SO of the multiplexer
(PDRF DISPS1 L and DISPSO L) after being inverted.

The PARITY indicators receive their input from the parity flip-flops on PDRH. The
Cache parity hits, DTML HI (or LO) BYTE PAR H are clocked into the same flip-flop
IC as PDRB BR(15:12)A H.  The output of these flip-flops, PDRB HI (or LO) PAR H
are clocked into PDRH DISP HI (or LO) PAR by UBCA IND CLK H. This signal is
asserted at T4 during the ROM state following the Pause cycle of all Cache
DATI/P cycles. The indicators are cleared at T4 of PAUSE of all Unibus cycles or
Cache DATO/B cycles by UBCB CLR IND (0) H.

2.12  MISCELLANEOUS INDICATOR LOGIC
The Console indicators not described in Paragraphs 2.10 and 2.11 are driven by
the logic signals listed below (in the same order as they appear in Chapter I).

ADDRESS SELECT SWITCH (1.2.1) - The indicators are driven directly by the
switch.

DATA SELECT SWITCH (1.2.3) - The indicators are driven directly by the switch.

PARITY (1.2.5) - PDRH IND HI PAR H and LO PAR H.

PAR ERR (1.3.1) - UBCB IND PAR ERR H

ADRS ERR (1.3.2) - SCCF IND ADRS ERR H

RUN (l.3.3) - TMCF IND RUN H.

PAUSE (1.3.4) - TMC IND PAUSE H.

MASTER (1.3.5) - UBCF IND MASTER H.

KERNEL SUPER, USER (1.3.6) - Driven by a decode (on the Console board) of SSR B
MMRO MODE 0 H and MMRO MODE 1 H.

ADDRESSING (Mapping) (1.3.7) - SCCF IND 16 (or 18 or 22) BIT MODE H.

DATA (Space) (1.3.8) - SAPK IND DATA H.
